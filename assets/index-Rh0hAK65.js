import{D as Q}from"./deadon-C-GpHaav.js";let h=24,m=0;const f=[[220,261.63,329.63,392,493.88,587.33],[146.83,174.61,220,261.63,329.63,392],[174.61,207.65,261.63,311.13,392,466.16],[196,233.08,293.66,349.23,440,523.25]],V=["#c24a4a","#c2864a","#4ac286","#4a86c2"];let T=0,R,x,L,N;function _(t){document.documentElement.style.setProperty("--primary-color",V[t])}let z=null;function j(t,n){z=t;let c=null,r=1/0,d=-1/0,q=0,b=0,s=0,A=0,M=120;function P(){return 60/(M*h)*1e3}function v(){const e=s?q/s:0;let o=s?b/s-e**2:0;o<0&&(o=0);const a=Math.sqrt(o),i=s?A/s*100:0,u=P(),l=document.getElementById("stats");l.innerHTML=`
    <b>Tick Stats</b><br>
    Target Tick: ${u.toFixed(2)} ms<br>
    Avg Tick: ${e.toFixed(2)} ms<br>
    Std Dev: ${a.toFixed(2)} ms<br>
    Min Tick: ${r===1/0?"-":r.toFixed(2)} ms<br>
    Max Tick: ${d===-1/0?"-":d.toFixed(2)} ms<br>
    Accurate Ticks (&plusmn;0.1ms): ${i.toFixed(2)}%<br>
    Total Ticks: ${s}
  `}const S=n.createGain(),g=.12;L=(e,o)=>{const a=n.createOscillator();a.frequency.value=16.35*13,a.type="square",a.frequency.linearRampToValueAtTime(0,e+g),S.gain.value=.5,S.gain.setTargetAtTime(0,e,g);const i=n.createBiquadFilter();i.type="lowpass",i.Q.value=2,i.frequency.value=500,i.frequency.linearRampToValueAtTime(16,e+g),a.connect(i).connect(S).connect(n.destination),a.start(e),a.stop(e+g)};const I=n.createGain();x=(e,o)=>{const a=n.createOscillator();a.type="square";const i=h*4,u=980,l=o%i===0;a.frequency.value=l?u*2:u,a.connect(I).connect(n.destination),a.start(e),a.stop(e+.04),I.gain.setValueAtTime(.07,e),I.gain.linearRampToValueAtTime(0,e+.04)};const y=n.createGain();y.gain.value=.15;const w=1.5;N=e=>{const o=f[m];y.connect(n.destination);const a=Math.round(Math.random())?1:0,i=Math.round(Math.random())?1:0;o.forEach((u,l)=>{if(l===4&&!a||l===5&&!i)return;const p=n.createOscillator();p.type="sawtooth",p.frequency.value=u,p.detune.value=(l-1)*3;const D=n.createStereoPanner(),K=(Math.round(Math.random())-.5)*.2;D.pan.value=K,p.connect(D).connect(y),p.start(e),p.stop(e+w)}),y.gain.setValueAtTime(.15,e),y.gain.linearRampToValueAtTime(0,e+w)};const k=n.createGain(),E=n.createStereoPanner();R=(e,o)=>{const a=n.createOscillator();a.type="triangle",a.frequency.value=o*(Math.round(Math.random())?2:Math.round(Math.random())?1:.5),k.gain.setValueAtTime(0,e),k.gain.linearRampToValueAtTime(.2,e+.04),k.gain.linearRampToValueAtTime(0,e+.2),E.pan.value=Math.round(Math.random())?-1:1,a.connect(E).connect(k).connect(n.destination),a.start(e),a.stop(e+.4)},t.on("tick",({timeMs:e})=>{if(c!==null){const o=e-c;q+=o,b+=o*o,Math.abs(o-P())<.1&&A++,o<r&&(r=o),o>d&&(d=o),s++,v()}c=e});function C(){c=null,r=1/0,d=-1/0,q=0,b=0,s=0,A=0}const O=document.getElementById("bpm");O.onchange=e=>{M=+O.value,t.setBpm(M),C()};const F=document.getElementById("startStop");F.onclick=async()=>{t.started?(t.stop(),C(),v(),F.textContent="Start"):(m=0,await n.resume(),await t.start(),F.textContent="Stop")};const $=document.getElementById("ppqn");$.onchange=()=>{h=+$.value,t.setPpqn(h),C()},v()}const J=t=>{const n=(m+f.length-1)%f.length,c=f[n],r=c[T%c.length];R(t.audioTime,r),T=(T+1)%c.length},U=t=>{console.log(t.audioTime*1e3,t.timeMs,performance.now()),x(t.audioTime,t.tick),L(t.audioTime,t.tick)},W=t=>{T=0,N(t.audioTime),m=(m+1)%f.length;const n=(m+V.length-1)%V.length;z.scheduleAt(()=>_(n),t.timeMs)},X=()=>h,Y=120,H=new AudioContext,B=new Q({bpm:Y,audioContext:H}),G=Array.from(document.querySelectorAll(".beat-indicator")),Z=t=>{G.forEach(c=>c.style.opacity="0.3");const n=G[t];n&&(n.style.opacity="1",setTimeout(()=>n.style.opacity="0.3",100))};B.on("tick",t=>{const n=X();if(t.tick%(n/4)===0&&J(t),t.tick%n===0){U(t);const c=t.tick/n%G.length;B.scheduleAt(()=>Z(c),t.timeMs)}t.tick%(n*4)===0&&W(t)});j(B,H);
