import{D as G}from"./deadon-CsrX2PgS.js";let y=24,d=0;const f=[[220,261.63,329.63,392,493.88,587.33],[146.83,174.61,220,261.63,329.63,392],[174.61,207.65,261.63,311.13,392,466.16],[196,233.08,293.66,349.23,440,523.25]],V=["#c24a4a","#c2864a","#4ac286","#4a86c2"];let T=0,R,x,L;function Q(n){document.documentElement.style.setProperty("--primary-color",V[n])}function j(n,t){let o=null,r=1/0,m=-1/0,q=0,M=0,i=0,b=0,A=120;function P(){return 60/(A*y)*1e3}function v(){const e=i?q/i:0;let c=i?M/i-e**2:0;c<0&&(c=0);const a=Math.sqrt(c),s=i?b/i*100:0,u=P(),l=document.getElementById("stats");l.innerHTML=`
    <b>Tick Stats</b><br>
    Target Tick: ${u.toFixed(2)} ms<br>
    Avg Tick: ${e.toFixed(2)} ms<br>
    Std Dev: ${a.toFixed(2)} ms<br>
    Min Tick: ${r===1/0?"-":r.toFixed(2)} ms<br>
    Max Tick: ${m===-1/0?"-":m.toFixed(2)} ms<br>
    Accurate Ticks (&plusmn;0.1ms): ${s.toFixed(2)}%<br>
    Total Ticks: ${i}
  `}const S=t.createGain(),g=.12;function H(e,c){const a=t.createOscillator();a.frequency.value=16.35*13,a.type="square",a.frequency.linearRampToValueAtTime(0,e+g),S.gain.value=.5,S.gain.setTargetAtTime(0,e,g);const s=t.createBiquadFilter();s.type="lowpass",s.Q.value=2,s.frequency.value=500,s.frequency.linearRampToValueAtTime(16,e+g),a.connect(s).connect(S).connect(t.destination),a.start(e),a.stop(e+g)}const I=t.createGain();x=(e,c)=>{const a=t.createOscillator();a.type="square";const s=y*4,u=980,l=c%s===0;a.frequency.value=l?u*2:u,a.connect(I).connect(t.destination),a.start(e),a.stop(e+.04),I.gain.setValueAtTime(.07,e),I.gain.linearRampToValueAtTime(0,e+.04),H(e)};const h=t.createGain();h.gain.value=.15;const E=1.5;L=e=>{const c=f[d];h.connect(t.destination);const a=Math.round(Math.random())?1:0,s=Math.round(Math.random())?1:0;c.forEach((u,l)=>{if(l===4&&!a||l===5&&!s)return;const p=t.createOscillator();p.type="sawtooth",p.frequency.value=u,p.detune.value=(l-1)*3;const D=t.createStereoPanner(),K=(Math.round(Math.random())-.5)*.2;D.pan.value=K,p.connect(D).connect(h),p.start(e),p.stop(e+E)}),h.gain.setValueAtTime(.15,e),h.gain.linearRampToValueAtTime(0,e+E)};const k=t.createGain(),O=t.createStereoPanner();R=(e,c)=>{const a=t.createOscillator();a.type="triangle",a.frequency.value=c*(Math.round(Math.random())?2:Math.round(Math.random())?1:.5),k.gain.setValueAtTime(0,e),k.gain.linearRampToValueAtTime(.2,e+.04),k.gain.linearRampToValueAtTime(0,e+.2),O.pan.value=Math.round(Math.random())?-1:1,a.connect(O).connect(k).connect(t.destination),a.start(e),a.stop(e+.4)},n.on("tick",e=>{if(o!==null){const c=e.scheduledTimeMs-o;q+=c,M+=c*c,Math.abs(c-P())<.1&&b++,c<r&&(r=c),c>m&&(m=c),i++,v()}o=e.scheduledTimeMs});function C(){o=null,r=1/0,m=-1/0,q=0,M=0,i=0,b=0}const $=document.getElementById("bpm");$.onchange=e=>{A=+$.value,n.setBpm(A),C()};const F=document.getElementById("startStop");F.onclick=async()=>{n.started?(n.stop(),C(),v(),F.textContent="Start"):(d=0,await t.resume(),await n.start(),F.textContent="Stop")};const w=document.getElementById("ppqn");w.onchange=()=>{y=+w.value,n.setPpqn(y),C()},v()}const J=n=>{const t=(d+f.length-1)%f.length,o=f[t],r=o[T%o.length];R(n.audioTime,r),T=(T+1)%o.length},U=n=>{x(n.audioTime,n.tick)},W=n=>{T=0,L(n.audioTime),d=(d+1)%f.length;const t=(d+V.length-1)%V.length;G.scheduleAt(()=>Q(t),n.scheduledTimeMs)},X=()=>y,Y=120,N=new AudioContext,z=new G({bpm:Y,audioContext:N}),B=Array.from(document.querySelectorAll(".beat-indicator")),Z=n=>{B.forEach(o=>o.style.opacity="0.3");const t=B[n];t&&(t.style.opacity="1",setTimeout(()=>t.style.opacity="0.3",100))};z.on("tick",n=>{const t=X();if(n.tick%(t/4)===0&&J(n),n.tick%t===0){U(n);const o=n.tick/t%B.length;G.scheduleAt(()=>Z(o),n.scheduledTimeMs)}n.tick%(t*4)===0&&W(n)});j(z,N);
